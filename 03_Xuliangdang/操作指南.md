# XuTwo.py 操作指南

## 1. 程序简介

本程序 (`XuTwo.py`) 是一个自动化的50ETF期权监控和收益模拟脚本。它根据预设的规则，在特定时间窗口内监控一篮子ETF期权（看涨和看跌期权）的价格变化，模拟投资组合的收益表现，并持续记录整个过程的数据，旨在实现系统化的投资策略回测和分析。

## 2. 主要功能

- **自动化监控**: 在预设的交易时间内自动监控期权价格变化。
- **策略化模拟**: 遵循固定的投资策略（如每月固定投资额，选择特定虚值档位的期权）进行收益模拟。
- **状态持久化**: 将当前监控状态（如选定合约、模拟成本、收益）保存到 `.json` 文件，程序重启后可恢复，保证数据连续性。
- **详细日志记录**:
    - 将关键操作和数据记录到月度日志文件 (`.log`) 中，便于问题排查。
    - 将每次监控的详细数据（价格、数量、收益率等）记录到 `.csv` 文件中。
- **自动切换合约**: 在当月合约即将到期时，自动将收益结转并切换到下个月的合约进行监控，实现复利计算。
- **数据清理**: 自动清理过期的日志和状态文件，保持整洁。

## 3. 文件结构说明

- `XuTwo.py`: **主程序文件**。包含了所有的监控逻辑和配置。
- `option_trading_YYYYMMDD.csv`: **监控总表**。`YYYYMMDD` 是您在 `CSV_START_DATE` 变量中设置的日期。该文件记录了从开始日期以来的所有监控数据。
- `option_trading_YYYYMM.csv`: **月度监控分表**。记录当月的详细监控数据。
- `option_trading_state_YYYYMM.json`: **状态文件**。以JSON格式保存程序当前运行状态，用于意外中断后的恢复。
- `option_trading_YYYYMM.log`: **日志文件**。记录程序的运行信息、警告和错误，是排查问题的重要依据。
- `backups/`: **备份文件夹**。自动备份被清理的旧日志和状态文件。

## 4. 配置说明

您可以直接修改 `XuTwo.py` 文件顶部的参数来调整交易策略。

- `CSV_START_DATE = "20250530"`
  - **功能**: 控制监控总表文件名的开始日期。
  - **说明**: 如果您想开始一个全新的监控记录周期，**只需修改此日期**（例如改为当天的日期 `20250923`）。程序重启后会自动创建一个新的CSV总表文件 (`option_trading_20250923.csv`)，而不会影响旧的数据。

- `MONTHLY_INVESTMENT = 1000`
  - **功能**: 每月投入的总金额（单位：元）。

- `CALL_INVESTMENT = 500` / `PUT_INVESTMENT = 500`
  - **功能**: 分别分配给看涨期权和看跌期权的资金。两者之和应等于 `MONTHLY_INVESTMENT`。

- `DAYS_BEFORE_EXPIRY_START = 19`
  - **功能**: 在合约到期前 `19` 天开始建仓并记录数据。

- `DAYS_BEFORE_EXPIRY_STOP = 1`
  - **功能**: 在合约到期前 `1` 天停止记录（并准备换月）。

- `CALL_OTM_LEVEL = 2` / `PUT_OTM_LEVEL = 2`
  - **功能**: 选择期权的虚值档数。`2` 代表选择“虚2档”的期权。

- `Debug_mode = 0`
  - **功能**: 调试模式开关。`0` 为生产模式（正常运行），`1` 为调试模式（会输出更详细的日志信息）。

## 5. 如何运行

1.  **安装依赖**: 确保您的 Python 环境中安装了 `requests` 库。如果未安装，请运行：
    ```bash
    pip install requests
    ```
2.  **运行程序**: 在命令行中直接运行主程序即可。
    ```bash
    python XuTwo.py
    ```
3.  **程序状态**: 程序启动后会持续运行，在非交易时间会自动休眠，并在交易时段被唤醒。您可以观察控制台输出的信息来了解其当前状态。

## 6. 注意事项

- 程序会进入一个**无限循环**，需要手动停止（例如按 `Ctrl+C`）才能退出。
- 请确保运行程序的设备网络通畅，因为程序需要通过网络API获取实时金融数据。
- 修改任何配置后，都需要**重启程序**才能生效。

## 7. 数据查看

- **交易总览**: 打开 `option_trading_YYYYMMDD.csv` 文件（`YYYYMMDD`为您配置的开始日期），可以查看所有历史交易记录。
- **当月详情**: 打开 `option_trading_YYYYMM.csv` 文件，可以查看当月更详细的逐笔记录。
- **日志查看**: 打开 `option_trading_YYYYMM.log` 文件，可以查看程序运行日志和错误信息。
- **状态文件**: `option_trading_state_YYYYMM.json` 文件保存程序运行状态，一般无需手动查看。
- 您可以使用 Excel、WPS 或任何支持CSV格式的软件来打开和分析这些数据。
